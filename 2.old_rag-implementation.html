

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Workshop Setup &#8212; AI Workshop</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '2.old_rag-implementation';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="AI Workshop - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="AI Workshop - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.rag-intro.html">1. Retrieval Augmented Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.rag-implementation.html">Workshop Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.rag-implementation_integrated.html">Workshop Setup</a></li>



<li class="toctree-l1"><a class="reference internal" href="3.experiment.html">3. Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.1.experiment_chunking.html">3.1. Chunking</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.2.experiment_embedding.html">3.2. Embeddings</a></li>
<li class="toctree-l1"><a class="reference internal" href="10.evaluation-production.html">Post-production</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F2.old_rag-implementation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/2.old_rag-implementation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Workshop Setup</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-requisites">Pre-requisites:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-required-libraries-and-environment-variables">Import required libraries and environment variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-search-index">1. Create Search Index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-embeddings">2. Create Embeddings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#embed-a-query-using-an-embedding-model-from-hugging-face">Embed a query using an embedding model from Hugging Face</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#create-embeddings-using-hugging-face-model">Create embeddings using Hugging Face model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upload-data">3. Upload data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search">4. Search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-a-vector-similarity-search">Perform a vector similarity search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-a-hybrid-search">Perform a hybrid search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-a-semantic-hybrid-search-required-semantic-ranker-enabled">Perform a semantic hybrid search - Required Semantic Ranker enabled</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="workshop-setup">
<h1>Workshop Setup<a class="headerlink" href="#workshop-setup" title="Permalink to this heading">#</a></h1>
<section id="pre-requisites">
<h2>Pre-requisites:<a class="headerlink" href="#pre-requisites" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://aka.ms/oai/access">Request Access to Azure OpenAI Service</a></p></li>
<li><p>Azure Search Service (which can host one or more search indexes) with Semantic Ranker enabled. Note: it is not supported in sweden central <a class="reference external" href="https://azure.microsoft.com/en-us/explore/global-infrastructure/products-by-region/?products=search">https://azure.microsoft.com/en-us/explore/global-infrastructure/products-by-region/?products=search</a></p></li>
<li><p>Azure OpenAI Service and text-embedding-ada-002 model deployed</p></li>
</ul>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>In this part, we will build the building blocks of a RAG solution.</p>
<ul class="simple">
<li><p>We will create a Search Index</p></li>
<li><p>We will create a prompt
…</p></li>
</ul>
<!-- To create the index we need the following objects:

- Data Source - a `link` to some data storage
- Azure Index - defines the data structure over which to search
  - Create an empty index based on an index schema
  - Fill in the data using the Search Indexer (below\_)
- Azure Search Indexer - which acts as a crawler that retrieves data from external sources, can also trigger skillsets (Optical Character Recognition) -->
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h3>
<p>First, we install the necessary dependencies.
<a class="github reference external" href="https://github.com/openai/openai-cookbook/blob/main/examples/azure/chat_with_your_own_data.ipynb">openai/openai-cookbook</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install python-dotenv
<span class="o">%</span><span class="k">pip</span> install azure-search-documents==11.4.0
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting python-dotenv
  Downloading python_dotenv-1.0.1-py3-none-any.whl.metadata (23 kB)
Downloading python_dotenv-1.0.1-py3-none-any.whl (19 kB)
Installing collected packages: python-dotenv
Successfully installed python-dotenv-1.0.1
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting azure-search-documents==11.4.0
  Using cached azure_search_documents-11.4.0-py3-none-any.whl.metadata (22 kB)
Collecting azure-core&lt;2.0.0,&gt;=1.28.0 (from azure-search-documents==11.4.0)
  Downloading azure_core-1.30.0-py3-none-any.whl.metadata (37 kB)
Collecting azure-common~=1.1 (from azure-search-documents==11.4.0)
  Using cached azure_common-1.1.28-py2.py3-none-any.whl (14 kB)
Collecting isodate&gt;=0.6.0 (from azure-search-documents==11.4.0)
  Using cached isodate-0.6.1-py2.py3-none-any.whl (41 kB)
Requirement already satisfied: requests&gt;=2.21.0 in c:\users\adnegrau\appdata\local\programs\python\python312\lib\site-packages (from azure-core&lt;2.0.0,&gt;=1.28.0-&gt;azure-search-documents==11.4.0) (2.31.0)
Requirement already satisfied: six&gt;=1.11.0 in c:\users\adnegrau\appdata\local\programs\python\python312\lib\site-packages (from azure-core&lt;2.0.0,&gt;=1.28.0-&gt;azure-search-documents==11.4.0) (1.16.0)
Requirement already satisfied: typing-extensions&gt;=4.6.0 in c:\users\adnegrau\appdata\local\programs\python\python312\lib\site-packages (from azure-core&lt;2.0.0,&gt;=1.28.0-&gt;azure-search-documents==11.4.0) (4.9.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\adnegrau\appdata\local\programs\python\python312\lib\site-packages (from requests&gt;=2.21.0-&gt;azure-core&lt;2.0.0,&gt;=1.28.0-&gt;azure-search-documents==11.4.0) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\users\adnegrau\appdata\local\programs\python\python312\lib\site-packages (from requests&gt;=2.21.0-&gt;azure-core&lt;2.0.0,&gt;=1.28.0-&gt;azure-search-documents==11.4.0) (3.6)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in c:\users\adnegrau\appdata\local\programs\python\python312\lib\site-packages (from requests&gt;=2.21.0-&gt;azure-core&lt;2.0.0,&gt;=1.28.0-&gt;azure-search-documents==11.4.0) (2.1.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\adnegrau\appdata\local\programs\python\python312\lib\site-packages (from requests&gt;=2.21.0-&gt;azure-core&lt;2.0.0,&gt;=1.28.0-&gt;azure-search-documents==11.4.0) (2023.11.17)
Using cached azure_search_documents-11.4.0-py3-none-any.whl (283 kB)
Downloading azure_core-1.30.0-py3-none-any.whl (193 kB)
   ---------------------------------------- 0.0/193.4 kB ? eta -:--:--
   -------------------------------------- - 184.3/193.4 kB 3.7 MB/s eta 0:00:01
   ---------------------------------------- 193.4/193.4 kB 3.9 MB/s eta 0:00:00
Installing collected packages: azure-common, isodate, azure-core, azure-search-documents
Successfully installed azure-common-1.1.28 azure-core-1.30.0 azure-search-documents-11.4.0 isodate-0.6.1
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<p>In this workshop, we’ll use <code class="docutils literal notranslate"><span class="pre">dotenv</span></code>. To connect with Azure OpenAI and the Search index, the following variables should be added to a .env file in KEY=VALUE format:
…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">dotenv</span>

<span class="c1"># %reload_ext dotenv</span>
<span class="c1"># %dotenv</span>
<span class="o">%</span><span class="k">reload_ext</span> dotenv
<span class="o">%</span><span class="k">dotenv</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-required-libraries-and-environment-variables">
<h3>Import required libraries and environment variables<a class="headerlink" href="#import-required-libraries-and-environment-variables" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">azure.core.credentials</span> <span class="kn">import</span> <span class="n">AzureKeyCredential</span>
<span class="kn">from</span> <span class="nn">azure.search.documents</span> <span class="kn">import</span> <span class="n">SearchClient</span>
<span class="kn">from</span> <span class="nn">azure.search.documents.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">VectorizedQuery</span><span class="p">,</span>
    <span class="n">VectorFilterMode</span><span class="p">,</span>
    <span class="n">QueryType</span><span class="p">,</span>
    <span class="n">QueryCaptionType</span><span class="p">,</span>
    <span class="n">QueryAnswerType</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">azure.search.documents.indexes.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SearchIndex</span><span class="p">,</span>
    <span class="n">ScoringProfile</span><span class="p">,</span>
    <span class="n">SearchFieldDataType</span><span class="p">,</span>
    <span class="n">SimpleField</span><span class="p">,</span>
    <span class="n">SearchableField</span><span class="p">,</span>
    <span class="n">SearchField</span><span class="p">,</span>
    <span class="n">SemanticConfiguration</span><span class="p">,</span>
    <span class="n">SemanticField</span><span class="p">,</span>
    <span class="n">VectorSearchProfile</span><span class="p">,</span>
    <span class="n">HnswAlgorithmConfiguration</span><span class="p">,</span>
    <span class="n">VectorSearch</span><span class="p">,</span>
    <span class="n">HnswParameters</span><span class="p">,</span>
    <span class="n">SemanticPrioritizedFields</span><span class="p">,</span>
    <span class="n">SemanticSearch</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">azure.search.documents.indexes</span> <span class="kn">import</span> <span class="n">SearchIndexClient</span>

<span class="n">subscription_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;subscription_id&quot;</span><span class="p">]</span>
<span class="n">resource_group_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;resource_group_name&quot;</span><span class="p">]</span>
<span class="n">workspace_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;workspace_name&quot;</span><span class="p">]</span>
<span class="n">service_endpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span>
    <span class="s2">&quot;service_endpoint&quot;</span>
<span class="p">]</span>  <span class="c1"># the endpoint of your Azure Cognitive Search service</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;search_key&quot;</span><span class="p">]</span>

<span class="c1"># aoai_connection_name = os.environ[&#39;aoai_connection_name&#39;]</span>
<span class="n">aoi_api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;aoi_api_key&quot;</span><span class="p">]</span>
<span class="n">aoai_endpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;aoai_endpoint&quot;</span><span class="p">]</span>
<span class="n">embedding_model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;embeddingModelName&quot;</span><span class="p">]</span>

<span class="n">search_index_name</span> <span class="o">=</span> <span class="s2">&quot;index_chunking&quot;</span>
<span class="n">search_index_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_SEARCH_ADMIN_KEY&quot;</span><span class="p">)</span>
<span class="n">credential</span> <span class="o">=</span> <span class="n">AzureKeyCredential</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">storage_account_connection_string</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;storage_account_connection_string&quot;</span><span class="p">)</span>
<span class="n">embeddingModelName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;embeddingModelName&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-search-index">
<h3>1. Create Search Index<a class="headerlink" href="#create-search-index" title="Permalink to this heading">#</a></h3>
<!-- https://github.com/Azure/azure-sdk-for-python/blob/main/sdk/search/azure-search-documents/samples/sample_index_crud_operations.py

https://github.com/microsoft/rag-experiment-accelerator/blob/development/rag_experiment_accelerator/init_Index/create_index.py

Used for overall Fields and Semantic Settings inspiration - https://github.com/Azure/azure-search-vector-samples/blob/main/demo-python/code/azure-search-vector-python-huggingface-model-sample.ipynb

Used for SearchField inspiration - https://github.com/Azure/azure-sdk-for-python/blob/main/sdk/search/azure-search-documents/samples/sample_vector_search.py -->
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_index</span><span class="p">(</span><span class="n">search_index_name</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">SearchIndexClient</span><span class="p">(</span><span class="n">service_endpoint</span><span class="p">,</span> <span class="n">AzureKeyCredential</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

    <span class="c1"># 1. Define the fields</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">SimpleField</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">sortable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">filterable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="c1"># facetable=True,</span>
        <span class="p">),</span>
        <span class="n">SearchableField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
        <span class="n">SearchableField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
        <span class="n">SearchableField</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">filterable</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
        <span class="n">SearchField</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;titleVector&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">Single</span><span class="p">),</span>
            <span class="n">searchable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">vector_search_dimensions</span><span class="o">=</span><span class="mi">384</span><span class="p">,</span>
            <span class="c1"># Assign a vector profile to the field to specify the algorithm</span>
            <span class="c1"># to use when searching the vector field.</span>
            <span class="n">vector_search_profile_name</span><span class="o">=</span><span class="s2">&quot;my-vector-config&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">SearchField</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;contentVector&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="n">SearchFieldDataType</span><span class="o">.</span><span class="n">Single</span><span class="p">),</span>
            <span class="n">searchable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">vector_search_dimensions</span><span class="o">=</span><span class="mi">384</span><span class="p">,</span>
            <span class="n">vector_search_profile_name</span><span class="o">=</span><span class="s2">&quot;my-vector-config&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">]</span>

    <span class="c1"># 2. Define the semantic Settings</span>
    <span class="c1"># Note: It requires semantic ranker enabled on your search service</span>
    <span class="c1"># https://learn.microsoft.com/en-us/azure/search/semantic-search-overview</span>
    <span class="c1"># https://learn.microsoft.com/en-us/azure/search/semantic-how-to-query-request?tabs=portal%2Cportal-query</span>
    <span class="c1"># https://learn.microsoft.com/en-us/azure/search/semantic-how-to-query-request?tabs=sdk%2Cportal-query</span>
    <span class="n">semantic_config</span> <span class="o">=</span> <span class="n">SemanticConfiguration</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-semantic-config&quot;</span><span class="p">,</span>
        <span class="n">prioritized_fields</span><span class="o">=</span><span class="n">SemanticPrioritizedFields</span><span class="p">(</span>
            <span class="n">title_field</span><span class="o">=</span><span class="n">SemanticField</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
            <span class="n">keywords_fields</span><span class="o">=</span><span class="p">[</span><span class="n">SemanticField</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)],</span>
            <span class="n">content_fields</span><span class="o">=</span><span class="p">[</span><span class="n">SemanticField</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="p">)],</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">semantic_search</span> <span class="o">=</span> <span class="n">SemanticSearch</span><span class="p">(</span><span class="n">configurations</span><span class="o">=</span><span class="p">[</span><span class="n">semantic_config</span><span class="p">])</span>

    <span class="c1"># 3. Configure the vector search configuration</span>
    <span class="n">vector_search</span> <span class="o">=</span> <span class="n">VectorSearch</span><span class="p">(</span>
        <span class="n">profiles</span><span class="o">=</span><span class="p">[</span>
            <span class="n">VectorSearchProfile</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-vector-config&quot;</span><span class="p">,</span>
                <span class="n">algorithm_configuration_name</span><span class="o">=</span><span class="s2">&quot;my-algorithms-config&quot;</span><span class="p">,</span>
                <span class="c1"># Configuring a vectorizer in a search index is currently in public preview and available through API and beta SDK.</span>
                <span class="c1"># A vectorizer is a component of a search index that specifies a vectorization agent, such as a deployed embedding model on Azure OpenAI that converts text to vectors. You can define a vectorizer once, and then reference it in the vector profile assigned to a vector field.</span>
                <span class="c1"># A vectorizer is used for queries. It allows the search service to vectorize a text query on your behalf.</span>
                <span class="c1"># https://learn.microsoft.com/en-us/azure/search/vector-search-how-to-configure-vectorizer</span>
            <span class="p">)</span>
        <span class="p">],</span>
        <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span>
            <span class="c1"># Contains configuration options specific to the hnsw approximate nearest neighbors  algorithm used during indexing and querying</span>
            <span class="n">HnswAlgorithmConfiguration</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-algorithms-config&quot;</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hnsw&quot;</span><span class="p">,</span>
                <span class="c1"># https://learn.microsoft.com/en-us/python/api/azure-search-documents/azure.search.documents.indexes.models.hnswparameters?view=azure-python-preview#variables</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">HnswParameters</span><span class="p">(</span>
                    <span class="n">m</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="c1"># The size of the dynamic list containing the nearest neighbors, which is used during index time.</span>
                    <span class="c1"># Increasing this parameter may improve index quality, at the expense of increased indexing time.</span>
                    <span class="n">ef_construction</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                    <span class="c1"># The size of the dynamic list containing the nearest neighbors, which is used during search time.</span>
                    <span class="c1"># Increasing this parameter may improve search results, at the expense of slower search.</span>
                    <span class="n">ef_search</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                    <span class="c1"># The similarity metric to use for vector comparisons.</span>
                    <span class="c1"># Known values are: &quot;cosine&quot;, &quot;euclidean&quot;, and &quot;dotProduct&quot;</span>
                    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">],</span>
        
    <span class="p">)</span>

    <span class="c1"># CORS is used for apps that issues requests from different domains.</span>
    <span class="c1"># cors_options = CorsOptions(allowed_origins=[&quot;*&quot;], max_age_in_seconds=60)</span>

    <span class="c1"># 4. Add scoring profiles when the default ranking behavior doesn&#39;t go far enough in meeting your business objectives.</span>
    <span class="c1"># https://learn.microsoft.com/en-us/azure/search/index-add-scoring-profiles</span>
    <span class="n">scoring_profiles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ScoringProfile</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">SearchIndex</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">search_index_name</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
        <span class="n">scoring_profiles</span><span class="o">=</span><span class="n">scoring_profiles</span><span class="p">,</span>
        <span class="c1"># cors_options=cors_options,</span>
        <span class="c1"># tokenizers=[], # TOOD: Add tokenizers,</span>
        <span class="n">semantic_search</span><span class="o">=</span><span class="n">semantic_search</span><span class="p">,</span>
        <span class="n">vector_search</span><span class="o">=</span><span class="n">vector_search</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_or_update_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> created or updated&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_index_name</span> <span class="o">=</span> <span class="s2">&quot;index_chunks_1&quot;</span>
<span class="n">create_index</span><span class="p">(</span><span class="n">search_index_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">HttpResponseError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">search_index_name</span> <span class="o">=</span> <span class="s2">&quot;index_chunks_1&quot;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">create_index</span><span class="p">(</span><span class="n">search_index_name</span><span class="p">)</span>

<span class="nn">Cell In[4], line 103,</span> in <span class="ni">create_index</span><span class="nt">(search_index_name)</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span> <span class="n">scoring_profiles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ScoringProfile</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span> <span class="n">index</span> <span class="o">=</span> <span class="n">SearchIndex</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span>     <span class="n">name</span><span class="o">=</span><span class="n">search_index_name</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span>     <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>     <span class="n">vector_search</span><span class="o">=</span><span class="n">vector_search</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span> <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">103</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_or_update_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> created or updated&quot;</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python312\Lib\site-packages\azure\core\tracing\decorator.py:78,</span> in <span class="ni">distributed_trace.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper_use_tracer</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="n">span_impl_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tracing_implementation</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">if</span> <span class="n">span_impl_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">78</span>     <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span> <span class="c1"># Merge span is parameter is set, but only if no explicit parent are passed</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span> <span class="k">if</span> <span class="n">merge_span</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">passed_in_parent</span><span class="p">:</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python312\Lib\site-packages\azure\search\documents\indexes\_search_index_client.py:264,</span> in <span class="ni">SearchIndexClient.create_or_update_index</span><span class="nt">(self, index, allow_index_downtime, match_condition, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">262</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">access_condition</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span> <span class="n">patched_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">_to_generated</span><span class="p">()</span>  <span class="c1"># pylint:disable=protected-access</span>
<span class="ne">--&gt; </span><span class="mi">264</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">create_or_update</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">265</span>     <span class="n">index_name</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">266</span>     <span class="n">index</span><span class="o">=</span><span class="n">patched_index</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">267</span>     <span class="n">allow_index_downtime</span><span class="o">=</span><span class="n">allow_index_downtime</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">268</span>     <span class="n">prefer</span><span class="o">=</span><span class="s2">&quot;return=representation&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">269</span>     <span class="n">error_map</span><span class="o">=</span><span class="n">error_map</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span>     <span class="o">**</span><span class="n">kwargs</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">272</span> <span class="k">return</span> <span class="n">SearchIndex</span><span class="o">.</span><span class="n">_from_generated</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python312\Lib\site-packages\azure\core\tracing\decorator.py:78,</span> in <span class="ni">distributed_trace.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper_use_tracer</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="n">span_impl_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">tracing_implementation</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">if</span> <span class="n">span_impl_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">78</span>     <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span> <span class="c1"># Merge span is parameter is set, but only if no explicit parent are passed</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span> <span class="k">if</span> <span class="n">merge_span</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">passed_in_parent</span><span class="p">:</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python312\Lib\site-packages\azure\search\documents\indexes\_generated\operations\_indexes_operations.py:715,</span> in <span class="ni">IndexesOperations.create_or_update</span><span class="nt">(self, index_name, prefer, index, allow_index_downtime, if_match, if_none_match, request_options, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">713</span>     <span class="n">map_error</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">error_map</span><span class="o">=</span><span class="n">error_map</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">714</span>     <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize</span><span class="o">.</span><span class="n">failsafe_deserialize</span><span class="p">(</span><span class="n">_models</span><span class="o">.</span><span class="n">SearchError</span><span class="p">,</span> <span class="n">pipeline_response</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">715</span>     <span class="k">raise</span> <span class="n">HttpResponseError</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">717</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">718</span>     <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">(</span><span class="s2">&quot;SearchIndex&quot;</span><span class="p">,</span> <span class="n">pipeline_response</span><span class="p">)</span>

<span class="ne">HttpResponseError</span>: (OperationNotAllowed) Existing field(s) &#39;chunkId&#39;, &#39;source&#39;, &#39;chunkContent&#39;, &#39;chunkContentVector&#39; cannot be deleted.
<span class="ne">Code</span>: OperationNotAllowed
<span class="ne">Message</span>: Existing field(s) &#39;chunkId&#39;, &#39;source&#39;, &#39;chunkContent&#39;, &#39;chunkContentVector&#39; cannot be deleted.
<span class="ne">Exception</span> <span class="n">Details</span><span class="p">:</span>	<span class="p">(</span><span class="n">CannotDeleteExistingField</span><span class="p">)</span> <span class="n">Existing</span> <span class="n">field</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="s1">&#39;chunkId&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;chunkContent&#39;</span><span class="p">,</span> <span class="s1">&#39;chunkContentVector&#39;</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">deleted</span><span class="o">.</span>
	<span class="n">Code</span><span class="p">:</span> <span class="n">CannotDeleteExistingField</span>
	<span class="n">Message</span><span class="p">:</span> <span class="n">Existing</span> <span class="n">field</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="s1">&#39;chunkId&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;chunkContent&#39;</span><span class="p">,</span> <span class="s1">&#39;chunkContentVector&#39;</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">deleted</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-embeddings">
<h3>2. Create Embeddings<a class="headerlink" href="#create-embeddings" title="Permalink to this heading">#</a></h3>
<!-- #### Which Embeddings Model to use?

There are several embedding options:

- OpenAI models, such as: [`text-embedding-ada-002`](https://platform.openai.com/docs/guides/embeddings/what-are-embeddings), `text-embedding-3-small`, `text-embedding-3-large`
- HuggingFace models, which offers a wide range of models. The [MTEB Leaderboard](https://huggingface.co/spaces/mteb/leaderboard) ranks the performance of embeddings models on a few axis, though not all models can be run locally. -->
<!-- ### a) Embed a query using an embedding model from OpenAI -->
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import requests</span>

<span class="c1"># def get_query_embedding(</span>
<span class="c1">#     query,</span>
<span class="c1">#     endpoint=aoai_endpoint,</span>
<span class="c1">#     api_key=aoi_api_key,</span>
<span class="c1">#     api_version=&quot;2023-07-01-preview&quot;,</span>
<span class="c1">#     embedding_model_deployment=embedding_model_name,</span>
<span class="c1"># ):</span>
<span class="c1">#     request_url = f&quot;{endpoint}/openai/deployments/{embedding_model_deployment}/embeddings?api-version={api_version}&quot;</span>
<span class="c1">#     headers = {&quot;Content-Type&quot;: &quot;application/json&quot;, &quot;api-key&quot;: api_key}</span>
<span class="c1">#     request_payload = {&quot;input&quot;: query}</span>
<span class="c1">#     embedding_response = requests.post(</span>
<span class="c1">#         request_url, json=request_payload, headers=headers, timeout=None</span>
<span class="c1">#     )</span>
<span class="c1">#     if embedding_response.status_code == 200:</span>
<span class="c1">#         data_values = embedding_response.json()[&quot;data&quot;]</span>
<span class="c1">#         embeddings_vectors = [data_value[&quot;embedding&quot;] for data_value in data_values]</span>
<span class="c1">#         return embeddings_vectors</span>
<span class="c1">#     else:</span>
<span class="c1">#         raise Exception(f&quot;failed to get embedding: {embedding_response.json()}&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># query = &quot;Hello&quot;</span>

<span class="c1"># query_vectors = get_query_embedding(</span>
<span class="c1">#     query, aoai_endpoint, aoi_api_key, &quot;2023-07-01-preview&quot;, embedding_model_name</span>
<span class="c1"># )</span>

<span class="c1"># print(f&quot;The embedded vector is: {query_vectors}&quot;)</span>
</pre></div>
</div>
</div>
</div>
<!-- #### Create embeddings using OpenAI

Read your data, generate embeddings using OpenAI model -->
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># with open(&quot;./data/text-sample.json&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;) as file:</span>
<span class="c1">#     input_data = json.load(file)</span>

<span class="c1"># for item in input_data:</span>
<span class="c1">#     title = item[&quot;title&quot;]</span>
<span class="c1">#     content = item[&quot;content&quot;]</span>
<span class="c1">#     title_embeddings = get_query_embedding(title)</span>
<span class="c1">#     content_embeddings = get_query_embedding(content)</span>
<span class="c1">#     item[&quot;titleVector&quot;] = title_embeddings</span>
<span class="c1">#     item[&quot;contentVector&quot;] = content_embeddings</span>

<span class="c1"># with open(&quot;./output/docVectors-openai.json&quot;, &quot;w&quot;) as f:</span>
<span class="c1">#     json.dump(input_data, f)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="embed-a-query-using-an-embedding-model-from-hugging-face">
<h3>Embed a query using an embedding model from Hugging Face<a class="headerlink" href="#embed-a-query-using-an-embedding-model-from-hugging-face" title="Permalink to this heading">#</a></h3>
<p>We will use <a class="reference external" href="https://huggingface.co/intfloat/e5-small-v2"><code class="docutils literal notranslate"><span class="pre">infloat/e5-small-v2</span></code></a> from Hugging Face, which is of size 0.13 GB.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;intfloat/e5-small-v2&quot;</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>

<span class="n">embedded_query</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">normalize_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">embedded_query</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Projects\Workshop2024\.venv\Lib\site-packages\tqdm\auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>384
</pre></div>
</div>
</div>
</div>
<section id="create-embeddings-using-hugging-face-model">
<h4>Create embeddings using Hugging Face model<a class="headerlink" href="#create-embeddings-using-hugging-face-model" title="Permalink to this heading">#</a></h4>
<p>Read your data, generate embeddings using HuggingFace model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;intfloat/e5-small-v2&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./data/text-sample.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
    <span class="n">title_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">normalize_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">normalize_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;titleVector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title_embeddings</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;contentVector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_embeddings</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./output/docVectors-e5.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="upload-data">
<h3>3. Upload data<a class="headerlink" href="#upload-data" title="Permalink to this heading">#</a></h3>
<!-- https://github.com/microsoft/rag-experiment-accelerator/blob/development/rag_experiment_accelerator/ingest_data/acs_ingest.py -->
<p>Add texts and metadata from the JSON data to the vector store using Hugging Face embedded vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upload some documents to the index</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./output/docVectors-e5.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>  
    <span class="n">documents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  
<span class="n">search_client</span> <span class="o">=</span> <span class="n">SearchClient</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">service_endpoint</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="n">search_index_name</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">search_client</span><span class="o">.</span><span class="n">upload_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Uploaded 108 documents
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Title: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Score: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;@search.score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Content: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Category: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">search_client</span> <span class="o">=</span> <span class="n">SearchClient</span><span class="p">(</span><span class="n">service_endpoint</span><span class="p">,</span> <span class="n">search_index_name</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">)</span>
<span class="n">query_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">normalize_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="search">
<h3>4. Search<a class="headerlink" href="#search" title="Permalink to this heading">#</a></h3>
<!-- https://techcommunity.microsoft.com/t5/ai-azure-ai-services-blog/azure-ai-search-outperforming-vector-search-with-hybrid/ba-p/3929167 -->
<p>There are two layers of execution: retrieval and ranking.</p>
<ul class="simple">
<li><p>Retrieval - also called L1, has the goal to quickly find all the documents from the index that satisfy the search criteria (possibly across millions or billions of documents). These are scored to pick the top few (typically in order of 50) to return to the user or to feed the next layer. Azure AI Search supports three different models:</p>
<ul>
<li><p>Keyword: Uses traditional full-text search methods – content is broken into terms through language-specific text analysis, inverted indexes are created for fast retrieval, and the BM25 probabilistic model is used for scoring.</p></li>
<li><p>Vector: Documents are converted from text to vector representations using an embedding model. Retrieval is performed by generating a query embedding and finding the documents whose vectors are closest to the query’s. We used Azure Open AI text-embedding-ada-002 (Ada-002) embeddings and cosine similarity for all our tests in this post.</p></li>
<li><p>Hybrid: Performs both keyword and vector retrieval and applies a fusion step to select the best results from each technique. Azure AI Search currently uses Reciprocal Rank Fusion (RRF) to produce a single result set.</p></li>
</ul>
</li>
<li><p>Ranking – also called L2, takes a subset of the top L1 results and computes higher quality relevance scores to reorder the result set. The L2 can improve the L1’s ranking because it applies more computational power to each result. The L2 ranker can only reorder what the L1 already found – if the L1 missed an ideal document, the L2 can’t fix that. L2 ranking is critical for RAG applications to make sure the best results are in the top positions.</p>
<ul>
<li><p>Semantic ranking is performed by Azure AI Search’s L2 ranker which utilizes multi-lingual, deep learning models adapted from Microsoft Bing. The Semantic ranker can rank the top 50 results from the L1.</p></li>
</ul>
</li>
</ul>
<p><a class="reference external" href="https://techcommunity.microsoft.com/t5/ai-azure-ai-services-blog/azure-ai-search-outperforming-vector-search-with-hybrid/ba-p/3929167">https://techcommunity.microsoft.com/t5/ai-azure-ai-services-blog/azure-ai-search-outperforming-vector-search-with-hybrid/ba-p/3929167</a></p>
</section>
<section id="perform-a-vector-similarity-search">
<h3>Perform a vector similarity search<a class="headerlink" href="#perform-a-vector-similarity-search" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;tools for software development&quot;</span>
<span class="n">vector_query</span> <span class="o">=</span> <span class="n">VectorizedQuery</span><span class="p">(</span>
    <span class="n">vector</span><span class="o">=</span><span class="n">query_embeddings</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">k_nearest_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;contentVector&quot;</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">search_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="n">search_text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vector_queries</span><span class="o">=</span><span class="p">[</span><span class="n">vector_query</span><span class="p">],</span>
    <span class="n">select</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">print_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Title: Azure Front Door
Score: 0.80073524
Content: Azure Front Door is a global, scalable, and secure entry point for fast delivery of your web applications. It provides features like load balancing, SSL offloading, and web application firewall (WAF). Front Door supports various Azure services, such as Azure App Service, Azure Storage, and Azure Virtual Machines. You can use Azure Front Door to build highly available and responsive applications, optimize your users&#39; experience, and improve the security of your infrastructure. It also integrates with other Azure services, such as Azure CDN and Azure Traffic Manager.
Category: Networking

Title: Azure Power BI Embedded
Score: 0.7912205
Content: Azure Power BI Embedded is a cloud-based analytics service that enables you to embed interactive visualizations and reports into your applications. It provides features like data exploration, custom visuals, and real-time data refresh. Power BI Embedded supports various data sources, such as Azure SQL Database, Azure Blob Storage, and on-premises databases. You can use Power BI Embedded to create data-driven applications, improve decision-making, and enhance user experiences. It also integrates with other Azure services, such as Azure Synapse Analytics and Azure Machine Learning.
Category: Analytics

Title: Azure API for FHIR
Score: 0.7905315
Content: Azure API for FHIR is a fully managed, standards-based API that enables you to store, manage, and exchange health data in the Fast Healthcare Interoperability Resources (FHIR) format. It provides features like data validation, versioning, and integration with Azure Active Directory. API for FHIR supports various data types, such as clinical, imaging, and administrative data. You can use Azure API for FHIR to build healthcare applications, ensure the security and compliance of your health data, and streamline your data management. It also integrates with other Azure services, such as Azure Machine Learning and Azure IoT Central.
Category: Healthcare
</pre></div>
</div>
</div>
</div>
</section>
<section id="perform-a-hybrid-search">
<h3>Perform a hybrid search<a class="headerlink" href="#perform-a-hybrid-search" title="Permalink to this heading">#</a></h3>
<p>Hybrid Retrieval brings out the best of Keyword and Vector Search</p>
<p>Keyword and vector retrieval tackle search from different perspectives, which yield complementary capabilities. Vector retrieval semantically matches queries to passages with similar meanings. This is powerful because embeddings are less sensitive to misspellings, synonyms, and phrasing differences and can even work in cross lingual scenarios. Keyword search is useful because it prioritizes matching specific, important words that might be diluted in an embedding.</p>
<p>User search can take many forms. Hybrid retrieval consistently brings out the best from both retrieval methods across query types. With the most effective L1, the L2 ranking step can significantly improve the quality of results in the top positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pure Vector Search</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;scalable storage solution&quot;</span>
<span class="n">query_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">normalize_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vector_query</span> <span class="o">=</span> <span class="n">VectorizedQuery</span><span class="p">(</span>
    <span class="n">vector</span><span class="o">=</span><span class="n">query_embeddings</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">k_nearest_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;contentVector&quot;</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">search_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="n">search_text</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
    <span class="n">vector_queries</span><span class="o">=</span><span class="p">[</span><span class="n">vector_query</span><span class="p">],</span>
    <span class="n">select</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">],</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">print_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Title: Azure Storage
Score: 0.03333333507180214
Content: Azure Storage is a scalable, durable, and highly available cloud storage service that supports a variety of data types, including blobs, files, queues, and tables. It provides a massively scalable object store for unstructured data. Storage supports data redundancy and geo-replication, ensuring high durability and availability. It offers a variety of data access and management options, including REST APIs, SDKs, and Azure Portal. You can secure your data using encryption at rest and in transit.
Category: Storage

Title: Azure File Storage
Score: 0.0320020467042923
Content: Azure File Storage is a fully managed, scalable, and secure file sharing service that enables you to store and access your files over the Server Message Block (SMB) protocol. It provides features like snapshots, shared access signatures, and integration with Azure Backup. File Storage supports various platforms, such as Windows, Linux, and macOS. You can use Azure File Storage to build file sharing solutions, lift and shift your applications to the cloud, and simplify your data management. It also integrates with other Azure services, such as Azure Virtual Machines and Azure Kubernetes Service.
Category: Storage

Title: Azure Blob Storage
Score: 0.03177805617451668
Content: Azure Blob Storage is a scalable, durable, and high-performance object storage service for unstructured data. It provides features like data redundancy, geo-replication, and fine-grained access control. Blob Storage supports various data types, such as images, documents, and videos. You can use Blob Storage to store and manage your data, build data lakes, and develop big data analytics solutions. It also integrates with other Azure services, such as Azure CDN, Azure Functions, and Azure Machine Learning.
Category: Storage
</pre></div>
</div>
</div>
</div>
</section>
<section id="perform-a-semantic-hybrid-search-required-semantic-ranker-enabled">
<h3>Perform a semantic hybrid search - Required Semantic Ranker enabled<a class="headerlink" href="#perform-a-semantic-hybrid-search-required-semantic-ranker-enabled" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;what is azure sarch?&quot;</span>

<span class="n">query_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">normalize_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vector_query</span> <span class="o">=</span> <span class="n">VectorizedQuery</span><span class="p">(</span>
    <span class="n">vector</span><span class="o">=</span><span class="n">query_embeddings</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">k_nearest_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;contentVector&quot;</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">search_client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="n">search_text</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
    <span class="n">vector_queries</span><span class="o">=</span><span class="p">[</span><span class="n">vector_query</span><span class="p">],</span>
    <span class="n">select</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">],</span>
    <span class="n">query_type</span><span class="o">=</span><span class="n">QueryType</span><span class="o">.</span><span class="n">SEMANTIC</span><span class="p">,</span>
    <span class="n">semantic_configuration_name</span><span class="o">=</span><span class="s2">&quot;my-semantic-config&quot;</span><span class="p">,</span>
    <span class="n">query_caption</span><span class="o">=</span><span class="n">QueryCaptionType</span><span class="o">.</span><span class="n">EXTRACTIVE</span><span class="p">,</span>
    <span class="n">query_answer</span><span class="o">=</span><span class="n">QueryAnswerType</span><span class="o">.</span><span class="n">EXTRACTIVE</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">semantic_answers</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_answers</span><span class="p">()</span>
<span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">semantic_answers</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">answer</span><span class="o">.</span><span class="n">highlights</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Semantic Answer: </span><span class="si">{</span><span class="n">answer</span><span class="o">.</span><span class="n">highlights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Semantic Answer: </span><span class="si">{</span><span class="n">answer</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Semantic Answer Score: </span><span class="si">{</span><span class="n">answer</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Title: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reranker Score: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;@search.reranker_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Content: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Category: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">captions</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;@search.captions&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">captions</span><span class="p">:</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="n">captions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">caption</span><span class="o">.</span><span class="n">highlights</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caption: </span><span class="si">{</span><span class="n">caption</span><span class="o">.</span><span class="n">highlights</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caption: </span><span class="si">{</span><span class="n">caption</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Semantic Answer: Azure File Storage is&lt;em&gt; a fully managed, scalable, and secure file sharing service that enables you to store and access your files over the Server Message Block (SMB) protocol.&lt;/em&gt; It provides features like snapshots, shared access signatures, and integration with Azure Backup. File Storage supports various platforms, such as Windows, Linux, and macOS.
Semantic Answer Score: 0.9208984375

Title: Azure Stack Edge
Reranker Score: 2.075716972351074
Content: Azure Stack Edge is a managed, edge computing appliance that enables you to run Azure services and AI workloads on-premises or at the edge. It provides features like hardware-accelerated machine learning, local caching, and integration with Azure IoT Hub. Azure Stack Edge supports various Azure services, such as Azure Functions, Azure Machine Learning, and Azure Kubernetes Service. You can use Azure Stack Edge to build edge computing applications, optimize your data processing, and ensure the security and compliance of your workloads. It also integrates with other Azure services, such as Azure Monitor and Azure Stack Hub.
Category: Hybrid
Caption: Azure Stack Edge is a managed, edge computing appliance that enables you to run Azure services and AI workloads on-premises or at the edge. It provides features like hardware-accelerated machine learning, local caching, and integration with Azure IoT Hub.

Title: Azure Security Center
Reranker Score: 1.9684149026870728
Content: Azure Security Center is a unified security management service that helps you protect your workloads and improve your security posture across your Azure resources and on-premises infrastructure. It provides features like continuous security assessments, threat protection, and security recommendations. Security Center supports various platforms, such as Windows, Linux, and Kubernetes. You can use Azure Security Center to detect and remediate threats, manage your security policies, and ensure compliance with industry regulations. It also integrates with other Azure services, such as Azure Monitor and Azure Log Analytics.
Category: Security
Caption: Azure Security Center is a unified security management service that helps you protect your workloads and improve your security posture across your Azure resources and on-premises infrastructure. It provides features like continuous security assessments, threat protection, and security recommendations.

Title: Azure Databricks
Reranker Score: 1.723077416419983
Content: Azure Databricks is an Apache Spark-based analytics platform optimized for the Azure cloud. It provides a collaborative workspace for data scientists, engineers, and business users to process, analyze, and visualize big data. Databricks supports multiple programming languages, including Python, Scala, R, and SQL. It offers built-in integration with Azure Blob Storage, Azure Data Lake Storage, and Azure Cosmos DB. You can also use Databricks to train and deploy machine learning models, and integrate with Azure Machine Learning.
Category: Analytics
Caption: Azure Databricks is an Apache Spark-based analytics platform optimized for the Azure cloud. It provides a collaborative workspace for data scientists, engineers, and business users to process, analyze, and visualize big data. Databricks supports multiple programming languages, including Python, Scala, R, and SQL.
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-requisites">Pre-requisites:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-required-libraries-and-environment-variables">Import required libraries and environment variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-search-index">1. Create Search Index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-embeddings">2. Create Embeddings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#embed-a-query-using-an-embedding-model-from-hugging-face">Embed a query using an embedding model from Hugging Face</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#create-embeddings-using-hugging-face-model">Create embeddings using Hugging Face model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upload-data">3. Upload data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search">4. Search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-a-vector-similarity-search">Perform a vector similarity search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-a-hybrid-search">Perform a hybrid search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#perform-a-semantic-hybrid-search-required-semantic-ranker-enabled">Perform a semantic hybrid search - Required Semantic Ranker enabled</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Raouf Aliouat & Adina Stoll
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>